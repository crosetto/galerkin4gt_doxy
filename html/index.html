<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Galerkin4GT: Galerkin methods using GridTools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Galerkin4GT
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Contributive effort to implement proof-of-concept Galerkin methods on new HPC architectures</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Galerkin methods using GridTools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Disclaimer"></a>
Disclaimer</h1>
<p>This library, as well as the GridTools libraries, are not yet final products, they are being constantly updated. We are in the process of fixing the API and preparing a first release for GridTools, while this library is still in the design phase. If you find any cryptic error, have suggestions for design changes or extensions, please write to me (<a href="#" onclick="location.href='mai'+'lto:'+'pao'+'lo'+'.cr'+'os'+'ett'+'o@'+'usy'+'s.'+'eth'+'z.'+'ch'; return false;">paolo<span style="display: none;">.nosp@m.</span>.cro<span style="display: none;">.nosp@m.</span>setto<span style="display: none;">.nosp@m.</span>@usy<span style="display: none;">.nosp@m.</span>s.eth<span style="display: none;">.nosp@m.</span>z.ch</a>), any feedback will be useful.</p>
<h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p><span style="background:white"> The main objective of the project is to investigate the design of numerical algorithms such as continuous or discontinuous finite elements, spectral elements, in simple explicit implementations, to assess their performance on new architectures. The target applications for the study are mainly in the domain of methereology and climate modeling.</span></p>
<p><span style="background:white">In order to achieve our goal we build a new library on top of GridTools, an optimized framework to express and run stencil-like computations which abstracts the underlying hardware architecture.</span></p>
<p><span style="background:white"> </span></p>
<h1><a class="anchor" id="sec_concepts"></a>
Generic Description and Concepts</h1>
<ul>
<li>
<a class="el" href="a05325.html">Installation instructions</a> </li>
<li>
<a class="el" href="a05323.html">Galerking Discretization (continuous)</a> </li>
<li>
<a class="el" href="a05319.html">Discontinuous Galerkin</a> </li>
<li>
<a class="el" href="a05322.html#examples">Examples</a> </li>
</ul>
<h1><a class="anchor" id="gt"></a>
GridTools</h1>
<p>The rapid evolution of the hardrware technology for HPC in the last years produced major changes in the programming techniques and alorithms employed on the software side, as well in the preferred numerical strategies chosen to solve several classical problems. However overcoming the lag between numerical schemes and their efficient implementations taylored on a specific hardware involves cross-disciplinary competencies and it is often very difficult. We propose here a set of libraries which will help the domain scientists to quickly discretize problems or to design a numerical scheme by taking full advantage of modern hardware architectures. We will present some of the optimization strategies as well as the user interface of GridTools, showing how to write a Finite Differences or Finite Elements discretization making use of the GridTools API.</p>
<h2><a class="anchor" id="The"></a>
Libraries</h2>
<p>The GridTools libraries are written in C++, which allows, via generic programming and template metaprogramming techniques, to abstract many of the core concepts which depend on the underlying architecture, like preferred memory layout, memory hierarchy, and preferred parallel programming models. Currently GPU and a Host backends are supported, for execution on NVIDIA GPUs and traditional CPUs respectively. A python JIT compiler is implemented together with the core C++ library as an environment for rapid prototyping.</p>
<h3><a class="anchor" id="Optimizations"></a>
Optimizations</h3>
<p>Among the optimizations we emphasize the following strategies:</p><ul>
<li>abstracted memory layout: the preferred memory layout varies with the choice of the backend, but the user code remains unchanged;</li>
<li>temporary storages, holding intermediate data which is not needed for post-processing, get automatically managed by the library in order to be as lightweight as possible.</li>
<li>concurrent stages, if no synchronization is needed between stages their execution can overlap</li>
<li>Host (OpenMP):<ol type="1">
<li>Loop tiling: consists in partitioning the storages into overlapping tiles and loop over one tile at a time. When temporary storages are needed in order to store intermediate results, these can be instantiated with the size of a tile, therefore fitting in the CPU cache. This algorithm allows a better utilization of the CPU caches, see <a class="el" href="a05352.html#CITEREF_Bianco2014">[1]</a> for details.</li>
<li>Vectorization: most modern CPUs feature a vector unit and are capable of issuing vector instructions when the data dependencies allow it. Compilers such as GCC and Clang are getting increasingly smarter in detecting the possibilities to automatically perform vectorization. Nevertheless special care is needed in order to exploit this feature in a generic library, since several factors may affect it (control flow, dynamic dispatch, alignment, pointer aliasing, type converisons, etc.)</li>
</ol>
</li>
<li>GPU (CUDA)<ol type="1">
<li>Stage fusion: consists in having the possibility of merging multiple computation stages which are logically separated into a single execution kernel, which performs all the stages either sequentially or concurrently, depending on the data dependency.</li>
<li>Software caches: the GPUs do not have caches for access to non constant data, for this purpose we use the GPU shared memory to read-write data which is frequently accessed (e.g. the storage strides and pointers, the value of temporary fields)</li>
<li>Read only data cache: loading data through the texture unit allows us to take advantage of the GPU's read only data cache.</li>
<li>Save resources: the size of the objects accessed in the innermost loop is crucial on a GPU, due to the limited amount of available resources per thread. In order to reduce the register pressure GridTools implements mechanisms to keep such memory consumption low.</li>
<li>Alignment: On the GPU unaligned access to the data still produces an overhead. GridTools makes sure that all accesses to global memory are properly aligned.</li>
</ol>
</li>
</ul>
<p>These optimization strategies prooved to be important in finite-differences testcases. Wether and to what extent these and other optimizations bring benefit to the case of Galerkin methods is something that we want to assess.</p>
<h3><a class="anchor" id="API"></a>
API</h3>
<p>The GridTools API is devided in two parts, as it will be clearer from the examples</p><ul>
<li>The user functors: this functor represents the innermost token of execution, and it is possibly executed on the device. It is a struct which defines the functor arguments as gridtools::accessor, and it implements a method called Do, in which the arguments are accessed given an offset. The functor is associated with and "iteration point", i.e. the current position (i,j,k) in the "iteration space". So the arguments accessed in this functor specifying a zero offset are accessing the data storage at the current iteration point.</li>
<li>The computation: provides the definition of the computation tree, which is split in dependent or independent "stages". The definition and control flow of the computation is handled on the host. In this step there is the binding of the functor arguments with actual storages, the copy to/from the device (if needed), the definition of the iteration space.</li>
</ul>
<p>Below are some feature implemented in GridTools in order to ease the construction of the computation tree: </p><a class="anchor" id="gt_API_features"></a>
<table class="doxtable">
<caption>Syntax </caption>
<tr>
<th>feature </th><th>description </th></tr>
<tr>
<td>conditional switches </td><td>choose between different (compie-time known) branches based on a runtime condition or predicate </td></tr>
<tr>
<td>forward/backward </td><td>choose the execution order of the innermost loop </td></tr>
<tr>
<td>expandable parameters </td><td>implements a "single stencil multiple storages" model: the user defines a vector of storages, and the same functor is executed for each of them </td></tr>
<tr>
<td>stencil functions </td><td>syntax allowing the user to call a functor directly from another functor </td></tr>
<tr>
<td>global accessor </td><td>a generic argument to the user functor which is not a storage </td></tr>
<tr>
<td>data_field storages </td><td>allows a single functor argument to hold an array of storages with the same size. </td></tr>
</table>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Apr 5 2017 09:06:12 for Galerkin4GT by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
